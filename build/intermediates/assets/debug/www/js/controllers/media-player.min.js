angular.module("starter").controller("MediaPlayerController",function($cordovaSocialSharing,$ionicHistory,Modal,$location,$rootScope,$scope,$state,$stateParams,$timeout,$translate,$window,Application,HomepageLayout,MediaPlayer,SB,SocialSharing,LinkService){$scope.is_webview=!$rootScope.isNativeApp,Modal.fromTemplateUrl("templates/media/music/l1/player/playlist.html",{scope:$scope}).then(function(modal){$scope.mediaplayer_playlist_modal=modal}),$scope.loadContent=function(){MediaPlayer.media||MediaPlayer.loading()},$scope.minimize=function(){$scope.goBack(),MediaPlayer.is_initialized=!1,MediaPlayer.is_minimized=!0,$rootScope.$broadcast(SB.EVENTS.MEDIA_PLAYER.SHOW)},$scope.destroy=function(){$scope.goBack(),MediaPlayer.destroy()},$scope.goBack=function(){MediaPlayer.is_radio&&MediaPlayer.is_initialized?HomepageLayout.getFeatures().then(function(features){if($scope.features=features,!Application.is_customizing_colors&&HomepageLayout.properties.options.autoSelectFirst&&$scope.features&&!1!==$scope.features.first_option){for(var featIndex=0,fi=0;fi<$scope.features.options.length;fi+=1){var feat=$scope.features.options[fi];if("code_scan"!==feat.code&&"radio"!==feat.code&&"padlock"!==feat.code){featIndex=fi;break}}$scope.features.options[featIndex].path!=$location.path()&&($ionicHistory.nextViewOptions({historyRoot:!0,disableAnimate:!1}),$location.path($scope.features.options[featIndex].path).replace())}else $ionicHistory.goBack(-2)}):$ionicHistory.goBack(-1)},$scope.openPlaylist=function(){$scope.mediaplayer_playlist_modal.show()},$scope.closePlaylist=function(){$scope.mediaplayer_playlist_modal.hide()},$scope.selectTrack=function(index){$scope.closePlaylist(),$timeout(function(){MediaPlayer.loading(),MediaPlayer.current_index=index,MediaPlayer.pre_start(),MediaPlayer.start()},500)},$scope.backward=function(){MediaPlayer.backward()},$scope.forward=function(){MediaPlayer.forward()},$scope.repeat=function(){MediaPlayer.repeat()},$scope.shuffle=function(){MediaPlayer.shuffle()},$scope.purchase=function(){$rootScope.isNotAvailableOffline()||MediaPlayer.current_track.purchaseUrl&&LinkService.openLink(MediaPlayer.current_track.purchaseUrl)},$scope.share=function(){var content=MediaPlayer.current_track.name;MediaPlayer.is_radio||(content=MediaPlayer.current_track.name+" from "+MediaPlayer.current_track.artistName);var file=MediaPlayer.current_track.albumCover?MediaPlayer.current_track.albumCover:void 0;SocialSharing.share(content,void 0,void 0,void 0,file)},$scope.loadContent()});