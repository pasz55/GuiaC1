angular.module("starter").controller("FormViewController",function(Location,$scope,$stateParams,$translate,Dialog,Form,GoogleMaps,Picture){angular.extend($scope,{is_loading:!0,value_id:$stateParams.value_id,formData:{},preview_src:{},geolocation:{},can_take_pictures:IS_NATIVE_APP,card_design:!1}),Form.setValueId($stateParams.value_id),$scope.loadContent=function(){Form.findAll().then(function(data){$scope.sections=data.sections,$scope.page_title=data.page_title}).then(function(){$scope.is_loading=!1})},$scope.getLocation=function(field){$scope.geolocation[field.id]?($scope.is_loading=!0,Location.getLocation().then(function(position){GoogleMaps.reverseGeocode(position.coords).then(function(results){results[0]?$scope.formData[field.id]=results[0].formatted_address:$scope.formData[field.id]=position.coords.latitude+", "+position.coords.longitude,$scope.is_loading=!1},function(data){$scope.formData[field.id]=null,$scope.geolocation[field.id]=!1,$scope.is_loading=!1})},function(e){$scope.is_loading=!1,$scope.formData[field.id]=null,$scope.geolocation[field.id]=!1})):$scope.formData[field.id]=null},$scope.takePicture=function(field){Picture.takePicture().then(function(success){$scope.preview_src[field.id]=success.image,$scope.formData[field.id]=success.image})},$scope.post=function(){if($scope.is_loading=!0,_.isEmpty($scope.formData))return void Dialog.alert("Error","You must fill at least one field!","OK",-1).then(function(){$scope.is_loading=!1});Form.post($scope.formData).then(function(data){$scope.formData={},$scope.preview_src={},Dialog.alert("Success",data.message,"OK",-1)},function(data){Dialog.alert("Error",data.message,"OK",-1)}).then(function(){$scope.is_loading=!1})},$scope.loadContent()});